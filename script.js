document.addEventListener('DOMContentLoaded', () => {
    const mapArea = document.getElementById('map-area');
    const mapTitle = document.getElementById('map-title');
    const toggleBtns = document.querySelectorAll('.map-toggle-btn');
    const markers = document.querySelectorAll('.marker');

    // 📌 추가: <img> 요소와 이미지 URL 정의
    const mapBackgroundImage = document.getElementById('map-background-image');

    const IMAGE_URLS = {
        '14': 'https://i.postimg.cc/DZgFJHkP/gwageo.png', // 14세 (과거) 지도 이미지 URL
        '22': 'https://i.postimg.cc/027m26xN/hyeonjae.png' // 22세 (현재) 지도 이미지 URL
    };
    // ------------------------------------

    // 모달 관련 요소
    const modal = document.getElementById('modal');
    const modalPlaceName = document.getElementById('modal-place-name');
    const modalColorBadge = document.getElementById('modal-color-badge');
    const modalMemoryMain = document.getElementById('modal-memory-main');
    const modalMemorySub = document.getElementById('modal-memory-sub');
    const modalAgeInfo = document.getElementById('modal-age-info');
    const closeBtn = document.querySelector('.close-btn');

    // 색깔 이름 매핑
    const colorNames = {
        'red': '싫은 장소',
        'green': '좋은 장소',
        'yellow': '보통 장소'
    };

    // 추억 데이터 (메인 내용과 인용구 형태의 서브 내용 구분)
    const memories = {
        "지하철": {
            "22": {
                main: "이젠 집을 갈 때 종종 2호선을 이용한다. 특히, 할로윈같은 스페셜한 날엔 2호선을 이용하면 죽음이다...",
                sub: "#인구 밀도 매우 높음 #외선,내선순환 #외국인 많음."
            },
            "14": {
                main: "14세 때는 몰랐던, 어른들의 멋진 카페였습니다. 왠지 모르게 들어가기 어려웠지만, 나도 언젠가 저런 곳에서 여유를 즐기고 싶다고 생각했죠.",
                sub: "어린 시절의 '어른스러운' 로망."
            }
        },
      
      "애슐리": {
            "22": {
                main: "버스정류장 버스정류장",
                sub: "#사랑니 고수선생님 #공장형 치과 #치과는 여전히 무서움"
            },
            "14": {
                main: "가족끼리 애슐리로 외식을 자주 갔다. 나는 먹는 걸 좋아해서 가족 중 내가 제일 애슐리를 좋아했다. 초코 분수는 항상 최고였다.",
                sub: "#2025년 현재는 사라진 장소 #애슐리퀸즈로 바뀜 #장소 이전함"
            }
        },
      
        "던킨": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "가성비 좋고 맛도 나름 있고 홍대 번화가와 근접성이 좋아 꽤 자주 갔었던 도넛집.",
                sub: "#2025년 현재까지도 남아있는 장소 #(소신발언) 던킨보다 크리스피크림이 더 맛있음"
            }
        },
      
        "삼성스토어": {
            "22": {
                main: "버스정류장 버스정류장",
                sub: "#사랑니 고수선생님 #공장형 치과 #치과는 여전히 무서움"
            },
            "14": {
                main: "내가 애플병이 걸리기 전, 삼성광인 어머니 덕분에 항상 삼성을 썼었다. 그래서 삼성스토어에 핸드폰을 구매하기 위해 자주 방문했었다.",
                sub: "#2025년 현재까지도 남아있는 장소 #삼성은 망하지 않음"
            }
        },
      
        "세계과자할인점": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "어릴 때, 과자를 참 좋아했다. 다양한 나라의 과자를 먹어보는 것에 취미가 들려 친구들이랑 홍대 올 때마다 한 번씩 들렸던 장소",
                sub: "#2025년 현재까지도 남아있는 장소 #저렴한 과자가 많음"
            }
        },
      
     
      "3POP PC방": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "오버워치에 푹 빠졌어서 중학교때 피시방을 자주 갔었다. 근데 피시방에 적응이 잘 안 되었을 시기라 담배존 + 지하에 위치한 피시방을 들어갈 때마다 떨렸다.",
                sub: "#2025년 현재는 사라진 장소 #오버워치가 한창 핫하던 시절"
            }
        },
      
        "맥도날드": {
            "22": {
                main: "버스정류장 버스정류장",
                sub: "#사랑니 고수선생님 #공장형 치과 #치과는 여전히 무서움"
            },
            "14": {
                main: "중학생때 친한 친구가 맥도날드를 참 좋아했다. 점심으로 맥도날드는 필수 코스였다. 맥도날드 먹고 3POP PC방 가는 코스는 국룰이었다.",
                sub: "#2025년 현재는 사라진 장소 #내 점심을 책임져주던 곳"
            }
        },
      
        "스파오": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "옷 스파브랜드 중 무난한 옷을 많이 판매해서 가끔 구매하러 방문했었다. 그치만 아기 시절이라 돈이 없었어서 엄마랑 같이 와야 폭풍 쇼핑이 가능했다.",
                sub: "#2025년 현재는 사라진 장소 #무난한 옷 많음"
            }
        },
      
      
        "Q코인노래방": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "번화가에서 거리가 살짝 멀어 자주 가진 않았던 노래방. 그치만 가격이 저렴하여 가성비 있어서 좋았다. 화장실 컨디션이 별로였던 노래방.",
                sub: "#2025년 현재까지도 남아있는 장소 #망하지 않고 여전히 남아있음"
            }
        },
      
      
        "엉터리생고기": {
            "22": {
                main: "버스정류장 버스정류장",
                sub: "#사랑니 고수선생님 #공장형 치과 #치과는 여전히 무서움"
            },
            "14": {
                main: "단합대회 끝나고 엉생을 처음 가봤는데 맛있었다. 심지어 무한리필집이라 자주 갔던 곳. 단합대회 끝나고 갔던 장소여서인지 엉생만 보면 중학교 시절 추억이 새록새록하다.",
                sub: "#2025년 현재까지도 남아있는 장소 #고기의 힘인가 #여전히 망하지 않고 남아있음"
            }
        },
      
        "엽기떡볶이": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "2017-18년도에, 엽떡붐이 있었다. 여자친구들끼리 놀면 엽떡은 무조건 먹는게 필수코스였다. 사실 난 엽떡보다 신전이 맛있었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      
      
        "싹쓰리": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "2017-18년도에 흰 양말붐이 있었다. 흰 양말을 신어야 옷 좀 잘 입네? 소리 들었다. 우리 중학교에서만 그랬던 것일 수도 있다. 이 양말샵은 양말을 저렴하게, 다양한 양말을 팔아서 좋았다.",
                sub: "#2025년 현재는 사라진 장소 #돌려내_가성비 양말샵"
            }
        },
      
         "서교초등학교": {
            "22": {
                main: "버스정류장 버스정류장",
                sub: "#사랑니 고수선생님 #공장형 치과 #치과는 여전히 무서움"
            },
            "14": {
                main: "유치원 동창들이 다녔던 학교. 그래서 서교초만 보면 유치원 동창들 생각이 새록새록 났다.",
                sub: "#2025년 현재까지도 남아있는 장소 #홍대 내에 위치한 유일한 초등학교"
            }
        },
      
        "에뛰드하우스": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "올리브영이 독점하지 않았던 시절. 그 땐, 에뛰드하우스로 아이섀도우를 많이 사러 갔었다. 에뛰드 하우스의 컨셉도 손님이 공주라는 컨셉이라 참 좋았는데.",
                sub: "#2025년 현재는 사라진 장소 #내 최애 섀도우는 해변에서 코코넛"
            }
        },
      
      
        "원더플레이스": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "중학생 땐, 버스킹을 참 많이 구경했다. 그 땐, 그룹으로 춤 추는 경우가 많아서 보는 재미가 있었다. 버스킹 구경하다보면 가끔 연예인도 볼 수 있었어서 좋았다.",
                sub: "#2025년 현재까지도 남아있는 장소 #방탄 춤 많이 췄었음"
            }
        },
      
      
      
        "버스정류장": {
            "22": {
                main: "버스정류장 버스정류장",
                sub: "#사랑니 고수선생님 #공장형 치과 #치과는 여전히 무서움"
            },
            "14": {
                main: "홍대에서 집까지 마포 08번 버스를 타면 왕복 40분이 걸렸다. 학교 갈 때도, 홍대 놀러갈 때도. 내가 학창시절 제일 많이 이용한 이동수단.",
                sub: "#2025년 현재까지도 남아있는 장소 #초록 버스"
            }
        },
      
        "커피덕": {
            "22": {
                main: "알바 면접을 이 카페에서 보기로 했었다. 다행스럽게도, 면접 보기 전 사이비임을 깨닫고 면접은 취소되었지만, 다신 가고싶진 않은 카페.",
                sub: "#사이비 #이 카페 사이비의 주된 면접 장소"
            },
            "14": {
                main: "친구들과 춤 연습을 하거나 플리마켓에서 신기한 물건들을 구경하던 아지트였습니다. 가장 순수하고 열정적이었던 추억이 가득한 장소.",
                sub: "우리의 모든 것이 시작된 곳."
            }
        },
        "사랑니아프니치과": {
            "22": {
                main: "사랑니를 안 아프게 잘 뽑는다고 소문난 치과. 실제로 2번 모두 안 아프게 뽑아주셨음!",
                sub: "#사랑니 고수선생님 #공장형 치과 #그치만 치과는 여전히 무서움"
            },
            "14": {
                main: "중학생 때 몰래 교복 입고 갔다가 선생님을 만날까봐 조마조마했던 기억입니다. 그땐 노래 한 곡 부르는 것도 큰 일탈이었죠.",
                sub: "사춘기의 아슬아슬한 일탈의 추억."
            }
        },
        "L7 홍대": {
            "22": {
                main: "서울에 살다보니, 서울에서 숙박을 해본 적이 없는데 친구와 함께 호캉스를 하고싶어 이 호텔에 방문했었다. 롯데리아가 1분컷이라 너무 좋았다.",
                sub: "#홍대 호텔 #숙박객들이 대부분 외국인 #뷔페 비추"
            },
            "14": {
                main: "어둡고 오래된 간판에 무심하게 지나쳤던 곳입니다. 왠지 어른들만 가는 곳 같아서 가볼 생각조차 못했던 신비로운 장소였죠.",
                sub: "14세에게는 미지의 세계였던 곳."
            }
        },
        "CGV": {
            "22": {
                main: "8년 사이에 체력이 많이 줄었나보다. 고층까지 올라가기 귀찮고 저층에 영화관이 있으면 좋았을 텐데... 조금 아쉬운 마음이 있다.",
                sub: "#고층 영화관 #알바생이 줄었음 #영화 보러오는 사람도 줄었음"
            },
            "14": {
                main: "영화관이 고층에 있어 중학생때 되게 좋아했던 장소.",
                sub: "#2025년 현재까지도 남아있는 장소 #그 당시엔 사람이 많았음"
            }
        },
      "할리스커피": {
            "22": {
                main: "계원예대 동기분들과 첫 작업 회의를 진행하기 위해 이 카페를 첫 방문했었다. 그게 벌써 2년 전이다.",
                sub: "#계원예대 동기 #카페 넓음 #사람 많음"
            },
            "14": {
                main: "영화관이 고층에 있어 중학생때 되게 좋아했던 장소.",
                sub: "2025년 현재까지도 남아있는 장소"
            }
        },
      "다이소": {
            "22": {
                main: "7층 다이소가 생기고 너무 좋다. 홍대이기에 가능한 고층 다이소 건물. 근데 엘베 타려면 사람이 많아서 그냥 계단을 주로 이용한다. ",
                sub: "#홍대 다이소 #7층까지 있음 #사람 많음"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
         "공차": {
            "22": {
                main: "버블티가 나이를 먹을 수록, 더 좋아진다. 홍대 갈 때마다 공차 버블티를 사먹는다. ",
                sub: "#사람 역대급 많음 #매장 내 좌석 없음 #지하철 입구 앞에 공차가 위치함"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
       "스팟칼라": {
            "22": {
                main: "계원예대 입시를 준비하기 위해 다녔던 학원. 나의 합격길까지 이끌어준, 준비하면서 되게 좋은 기억이 많은 학원.",
                sub: "#성윤쌤 잘 지내시나요 #고3 #수시 2차"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      "그린섬": {
            "22": {
                main: "인생에서 역대급 힘든 기억 TOP3를 만들어줬다. 기디 입시는 말로 표현하지 못할 정도로 힘들었다. ",
                sub: "#선생님=군대 교관 #물감 #경쟁 "
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
       "발바리네": {
            "22": {
                main: "그린섬을 다닌 사람이라면 아는 홍대 최고 맛집. 식사 시간대에 가면, 그린섬 학생들 많이 볼 수 있다.",
                sub: "#데리야끼제육정식 #제육정식 #맛있음"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
        "홍익대학교": {
            "22": {
                main: "내가 홍대부속여고를 나왔는데 내가 아는 고등학교 동창 중 홍대를 간 친구는 없다. 신기하게도, 사회를 나와 친해진 친한 친구들이 홍대에 많이 재학중. ",
                sub: "#홍대 #홍대 앞 핫플 #부럽다 #학교가 엄청 큼 "
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
       "포토그레이": {
            "22": {
                main: "홍대에 위치한 사진부스 중 포토크레이가 제일 잘 나온다. 제일 보정이 잘 되고 예쁘게 나오는 곳",
                sub: "#항상 사람 많음 #포토그레이는 유독 잼민 친구들이 많음"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      
       "시장을여는사람들": {
            "22": {
                main: "안주가 맛있고, 맛있는 술들이 많다! 친한 친구들이랑 갔었어서 더욱 재밌는 추억이 많은 술집. ",
                sub: "#홍대술집 #MZ많음 #안주보다 술이 더 맛있음 "
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      "역전할머니맥주": {
            "22": {
                main: "20살 된 후, 처음 갔던 술집. 가성비 술집이라 20살 때 많이 갔지만 요즘은 잘 안 가는 술집 ",
                sub: "#홍대술집 #MZ많음 #가성비 술집"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      
       "포토그레이": {
            "22": {
                main: "홍대에 위치한 사진부스 중 포토크레이가 제일 잘 나온다. 제일 보정이 잘 되고 예쁘게 나오는 곳",
                sub: "#항상 사람 많음 #포토그레이는 유독 잼민 친구들이 많음"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      
       "락휴": {
            "22": {
                main: "홍대에 위치한 사진부스 중 포토크레이가 제일 잘 나온다. 제일 보정이 잘 되고 예쁘게 나오는 곳",
                sub: "#항상 사람 많음 #포토그레이는 유독 잼민 친구들이 많음"
            },
            "14": {
                main: "중학생 때, 홍대 노는 코스에 락휴는 필수 코스였다. 근접성 + 가격적 측면에서 홍대에 위치한 제일 베스트 노래방이기에.",
                sub: "2025년 현재까지도 남아있는 장소 #락휴 VVIP"
            }
        },
      
          "원더플레이스": {
            "22": {
                main: "홍대에 위치한 사진부스 중 포토크레이가 제일 잘 나온다. 제일 보정이 잘 되고 예쁘게 나오는 곳",
                sub: "#항상 사람 많음 #포토그레이는 유독 잼민 친구들이 많음"
            },
            "14": {
                main: "패피라면 다들 한 번쯤은 구매해줘야하는 원더플레이스였다. 원더플레이스에서 옷 안 사 봤으면 문찐 취급 받았다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      
       "카카오프렌즈샵": {
            "22": {
                main: "홍대에 위치한 사진부스 중 포토크레이가 제일 잘 나온다. 제일 보정이 잘 되고 예쁘게 나오는 곳",
                sub: "#항상 사람 많음 #포토그레이는 유독 잼민 친구들이 많음"
            },
            "14": {
                main: "중학생 때, 홍대 노는 코스에 락휴는 필수 코스였다. 근접성 + 가격적 측면에서 홍대에 위치한 제일 베스트 노래방이기에.",
                sub: "2025년 현재까지도 남아있는 장소 #락휴 VVIP"
            }
        },
      
       
      "오렌즈": {
            "22": {
                main: "항상 렌즈 사러갈 때, 방문하는 오렌즈. 내 눈엔 오렌즈의 렌즈가 제일 편해서 n년째 방문중이다.",
                sub: "#먼슬리 렌즈 저렴 #원데이 투명렌즈 좋음 #나름 가성비 렌즈"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      
   
       "올리브영": {
            "22": {
                main: "홍대에 위치한 올리브영이라 그런가 사람이 유독 많다. 그래서 기빨려서 안 들어가고 싶지만, 참새가 방앗간을 그냥 지나칠리가 있으랴...",
                sub: "#항상 사람 많음 #외국인이 70%인 듯 #직원도 많음"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      
      "악쓰는하마": {
            "22": {
                main: "홍대 핫플 술집 근처에 위치하여, 근접성이 좋아 자주 방문하는 노래방. 가성비가 좋진 않다.",
                sub: "#가성비 노래방 내놔 #근접성 최고 #시설 깔끔"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      
         "보승회관": {
            "22": {
                main: "술먹고 해장하기 위해 자주가는 맛집. 가격대비 맛있음! 그리고 여기 방문하는 사람들이 다 주변 술집 갔다 해장하러 오는 거라 새벽에 사람이 많다.",
                sub: "#국밥 맛집 #순대국밥 JMT #체인점"
            },
            "14": {
                main: "지하 1층,1층,2층까지가 다이소였다. 항상 사람이 많아서 결제줄이 매우 길었었다. 이 땐 키오스크도 없었다.",
                sub: "2025년 현재까지도 남아있는 장소이지만 위치는 이전 되었다."
            }
        },
      
       "버스킹존": {
            "22": {
                main: "요근래에, 춤보단 노래를 부르며 버스킹하는 분들이 많다. 가끔 시간 떼우려고 버스킹 구경한다.",
                sub: "#버스킹 #노래 #가끔 노래 고수 등장"
            },
            "14": {
                main: "중학생 땐, 버스킹을 참 많이 구경했다. 그 땐, 그룹으로 춤 추는 경우가 많아서 보는 재미가 있었다. 버스킹 구경하다보면 가끔 연예인도 볼 수 있었어서 좋았다.",
                sub: "2025년 현재까지도 남아있는 장소 #방탄 춤 많이 췄었음"
            }
        },
        "AK 플라자": {
            "22": {
                main: "저층부터 고층까지 정말 내 취향인 장소가 많다. 의류가게, 소품샵 등 돈이 텅장이 되는 장소.",
                sub: "#애니원모어 #쇼핑센터 #구경거리 많음 #시간 순삭."
            },
            "14": {
                main: "새 학기 옷을 사거나 친구들끼리 모여 최신 유행하는 물건들을 구경하던 꿈의 공간이었습니다. 돈은 없어도 보는 것만으로도 행복했어요.",
                sub: "#애니원모어 #쇼핑센터 #구경거리 많음 #시간 순삭"
            }
        }
    };

    function updateMap(age) {
        const is14 = age === '14';
        const currentAgeClass = is14 ? 'age-14-map' : 'age-22-map';
        const currentTitleClass = is14 ? 'title-14' : 'title-22';
        const currentTitleText = is14 ? '🕰️ 14세의 홍대' : '✨ 22세의 홍대';

        // 1. 지도 배경 및 제목 업데이트
        mapArea.className = '';
        mapArea.classList.add(currentAgeClass);
        mapTitle.className = '';
        mapTitle.classList.add(currentTitleClass);
        mapTitle.innerHTML = currentTitleText;
        
        // 📌 핵심 수정: <img> 태그의 src 속성 변경
        mapBackgroundImage.src = IMAGE_URLS[age];
        mapBackgroundImage.alt = is14 ? '홍대 과거 지도' : '홍대 현재 지도';
        // ---------------------------------

        // 2. 버튼 활성화 상태 업데이트
        toggleBtns.forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.age === age) {
                btn.classList.add('active');
            }
        });

        // 3. 마커 가시성 업데이트
        markers.forEach(marker => {
            if (marker.dataset.age === age) {
                marker.classList.add('visible');
            } else {
                marker.classList.remove('visible');
            }
        });
    }

    // 초기 지도 설정 (14세)
    updateMap('14');

    // 맵 전환 버튼 이벤트 리스너
    toggleBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            // 버튼 자체 또는 아이콘을 클릭해도 동작하도록 .closest 사용
            const newAge = e.target.closest('.map-toggle-btn').dataset.age;
            updateMap(newAge);
        });
    });

    // 마커 클릭 이벤트 리스너 (팝업 표시)
    markers.forEach(marker => {
        marker.addEventListener('click', () => {
            const fullName = marker.dataset.name;
            const placeName = fullName.split(' (')[0];
            const markerAge = marker.dataset.age;
            const color = marker.dataset.color;

            const memoryData = memories[placeName] ? memories[placeName][markerAge] : { main: "추억 기록이 없습니다.", sub: "기록이 없어 아쉽네요." };

            // 모달 내용 채우기
            modalPlaceName.textContent = placeName;

            // 뱃지 설정
            modalColorBadge.textContent = colorNames[color];
            modalColorBadge.className = '';
            modalColorBadge.classList.add('badge-' + color);

            modalMemoryMain.textContent = memoryData.main;
            modalMemorySub.textContent = `"${memoryData.sub}"`;

            modalAgeInfo.textContent = `나의 홍대, ${markerAge}세의 기억.`;

            // 모달 보여주기
            modal.classList.remove('hidden');
        });
    });

    // 모달 닫기 이벤트 리스너
    closeBtn.addEventListener('click', () => {
        modal.classList.add('hidden');
    });

    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.add('hidden');
        }
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
            modal.classList.add('hidden');
        }
    });
});